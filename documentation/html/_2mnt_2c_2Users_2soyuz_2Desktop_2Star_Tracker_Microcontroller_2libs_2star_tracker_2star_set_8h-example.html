<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Star Tracker: /mnt/c/Users/soyuz/Desktop/Star_Tracker_Microcontroller/libs/star_tracker/star_set.h</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Star Tracker
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">/mnt/c/Users/soyuz/Desktop/Star_Tracker_Microcontroller/libs/star_tracker/star_set.h</div>  </div>
</div><!--header-->
<div class="contents">
<p>Stores data on a set of stars to make a unique set.</p>
<pre class="fragment">- The unique features are the position of the opposite (angle) star.
- The angle between the stars and the opposite.
- The likelyhood of it being the correct match.
- The orientation of the opposite star to its farthest not pilot.
- A StarSet of the image.


star_tracker::StarSet::set_fov(100);    // Sets the field of view to 100 for all calculations.


const util::uint input_size = 3;
const util::uint output_size = 5;
util::ArrayList&lt;util::Point&lt;util::decimal&gt;, input_size&gt; input;
util::ArrayList&lt;star_tracker::StarSet, output_size&gt; output;
util::Point&lt;util::decimal&gt; pilot(0, 0);
util::Point&lt;util::decimal&gt; s1(0, 1);
util::Point&lt;util::decimal&gt; s2(1, 0);
util::Point&lt;util::decimal&gt; s3(1, 1);
util::Point&lt;util::decimal&gt; s4(1, 2);

// The stars must be in order of magnitude:
input.PushBack(pilot);
input.PushBack(s1);
input.PushBack(s2);
input.PushBack(s3);
input.PushBack(s4);

// Finds all the combinations assuming they are ordered in apperant magnitude (brightest first).
// Tries: (0, 1, 2, 3), (0, 1, 2, 4), (0, 1, 3, 4), (0, 2, 3, 4), (1, 2, 3, 4).
star_tracker::StarSet::GenerateSetsPilots&lt;input_size, output_size&gt;(input, 0, 5, &amp;output);

cout &lt;&lt; output.Get(0).angle &lt;&lt; endl; // angle between (s1, s3, s2) as s3 is farthest the opposite (pi/4, (90 degrees)).

// Cluster probability will favour close matching points.
// If multiple matches are close to the same place, the likelyhood of this being the correct match is higher.
// The more within the fov, the higher the odds.
decimal fov = 1;
star_tracker::StarSetClusterProbability&lt;output_size&gt;(fov, &amp;output);
output.Get(0).odds;

// For constructing the database
string str;
for ( int i = 0; i &lt; output.Size(); i++ )
{
    output.Get(i).ToArrayString(&amp;str);
}
</pre> <dl class="section author"><dt>Author</dt><dd>Tom Creusot</dd></dl>
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> *  Stores data on a set of stars to make a unique set.</span></div><div class="line"><span class="comment"> *  @file   StarSet.h</span></div><div class="line"><span class="comment"> *  @author Tom Creusot</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#pragma once</span></div><div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="util_8h.html">libs/util/util.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="array__list_8h.html">libs/util/array_list.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="point_8h.html">libs/util/point.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceutil.html">util</a>;</div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacestd.html">std</a>;</div><div class="line"></div><div class="line"><span class="keyword">namespace </span><a class="code" href="namespacestar__tracker.html">star_tracker</a></div><div class="line">{</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">class </span>StarSet</div><div class="line">{</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">static</span> util::decimal fov;</div><div class="line">    <span class="keyword">static</span> util::decimal pixel_resolution;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    constexpr <span class="keyword">static</span> util::uint kDatabaseIndexAngle         = 0;</div><div class="line">    constexpr <span class="keyword">static</span> util::uint kDatabaseIndexDist          = 1;</div><div class="line">    constexpr <span class="keyword">static</span> util::uint kDatabaseIndexOrientation   = 2;</div><div class="line">    constexpr <span class="keyword">static</span> util::uint kDatabaseIndexOppositeX     = 3;</div><div class="line">    constexpr <span class="keyword">static</span> util::uint kDatabaseIndexOppositeY     = 4;</div><div class="line"></div><div class="line">    constexpr <span class="keyword">static</span> util::uint kDatabaseNumElements        = 5;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    constexpr <span class="keyword">static</span> util::decimal kInvalidAngle = NAN;</div><div class="line">    constexpr <span class="keyword">static</span> util::decimal kSeparationDiv = 1.000001;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    decimal angle;              </div><div class="line">    decimal distance;           </div><div class="line">    StarSet* pixel;             </div><div class="line">    decimal odds;               </div><div class="line">    decimal orientation;        </div><div class="line">    <a name="_a0"></a><a class="code" href="classutil_1_1Point.html">Point&lt;decimal&gt;</a> opposite;    </div><div class="line"></div><div class="line">    StarSet ( );</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    StarSet (   <a class="code" href="classutil_1_1Point.html">Point&lt;decimal&gt;</a>&amp; p,</div><div class="line">                <a class="code" href="classutil_1_1Point.html">Point&lt;decimal&gt;</a>&amp; s1, <a class="code" href="classutil_1_1Point.html">Point&lt;decimal&gt;</a>&amp; s2, <a class="code" href="classutil_1_1Point.html">Point&lt;decimal&gt;</a>&amp; s3 );</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    StarSet ( StarSet&amp; px );</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> FindCenter (   decimal fovPP,</div><div class="line">                        <a name="_a1"></a><a class="code" href="classutil_1_1Point.html">Point&lt;int&gt;</a>&amp; size,</div><div class="line">                        <a class="code" href="classutil_1_1Point.html">Point&lt;decimal&gt;</a>* center );</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> ToArrayString ( <span class="keywordtype">string</span>* str );</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">template</span>&lt;<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> N1, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> N2&gt;</div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> GenerateSetsPilots (    <a name="_a2"></a><a class="code" href="classutil_1_1ArrayList.html">ArrayList</a>&lt;<a class="code" href="classutil_1_1Point.html">Point&lt;decimal&gt;</a>, N1&gt;&amp; list,</div><div class="line">                                        uint start, uint end,</div><div class="line">                                        <a class="code" href="classutil_1_1ArrayList.html">ArrayList&lt;StarSet, N2&gt;</a>* sets        )</div><div class="line">    {</div><div class="line">        <span class="keywordflow">for</span> ( uint ii = start; ii &lt; end; ii++ )</div><div class="line">            <span class="keywordflow">for</span> ( uint jj = ii + 1; jj &lt; end; jj++ )</div><div class="line">                <span class="keywordflow">for</span> ( uint kk = jj + 1; kk &lt; end; kk++ )</div><div class="line">                    <span class="keywordflow">for</span> ( uint ll = kk + 1; ll &lt; end; ll++ )</div><div class="line">                    {</div><div class="line">                        <a class="code" href="classutil_1_1Point.html">Point&lt;decimal&gt;</a>* pilot   = &amp;list.Get(ii);</div><div class="line">                        <a class="code" href="classutil_1_1Point.html">Point&lt;decimal&gt;</a>* s1      = &amp;list.Get(jj);</div><div class="line">                        <a class="code" href="classutil_1_1Point.html">Point&lt;decimal&gt;</a>* s2      = &amp;list.Get(kk);</div><div class="line">                        <a class="code" href="classutil_1_1Point.html">Point&lt;decimal&gt;</a>* s3      = &amp;list.Get(ll);</div><div class="line"></div><div class="line">                        StarSet <span class="keyword">set</span>(*pilot, *s1, *s2, *s3);</div><div class="line">                        <span class="keywordflow">if</span> ( <span class="keyword">set</span>.angle != kInvalidAngle ) sets-&gt;<a name="a3"></a><a class="code" href="classutil_1_1ArrayList.html#a75e2f1682ebe7a982b6fd301d416d536">PushBack</a>(<span class="keyword">set</span>);</div><div class="line">                    }</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">template</span> &lt; u<span class="keywordtype">int</span> N1 &gt;</div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> ClusterProbability ( <a class="code" href="classutil_1_1ArrayList.html">ArrayList&lt;StarSet, N1&gt;</a>* database )</div><div class="line">    {</div><div class="line">        <span class="keywordflow">for</span> ( uint ii = 0; ii &lt; database-&gt;<a name="a4"></a><a class="code" href="classutil_1_1ArrayList.html#ae098e879892c23b682edc4b023a770de">Size</a>(); ii++ )</div><div class="line">            <span class="keywordflow">for</span> ( uint jj = 0; jj &lt; database-&gt;<a class="code" href="classutil_1_1ArrayList.html#ae098e879892c23b682edc4b023a770de">Size</a>(); jj++ )</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> ( ii != jj )</div><div class="line">                {</div><div class="line">                    decimal dist =</div><div class="line">                            database-&gt;<a name="a5"></a><a class="code" href="classutil_1_1ArrayList.html#ac5a4259af59f7bac9df06851c29d9e37">Get</a>(ii).opposite.Distance(database-&gt;<a class="code" href="classutil_1_1ArrayList.html#ac5a4259af59f7bac9df06851c29d9e37">Get</a>(jj).opposite);</div><div class="line">                    <span class="keywordflow">if</span> ( dist &gt; fov )</div><div class="line">                    {</div><div class="line">                        database-&gt;<a class="code" href="classutil_1_1ArrayList.html#ac5a4259af59f7bac9df06851c29d9e37">Get</a>(ii).odds /= kSeparationDiv;</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> SortDistance    (   <a class="code" href="classutil_1_1Point.html">Point&lt;decimal&gt;</a>&amp; pilot,</div><div class="line">                                    <a class="code" href="classutil_1_1Point.html">Point&lt;decimal&gt;</a>* s1, <a class="code" href="classutil_1_1Point.html">Point&lt;decimal&gt;</a>* s2  );</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">static</span> decimal FindAngle (  <a class="code" href="classutil_1_1Point.html">Point&lt;decimal&gt;</a>&amp; center,</div><div class="line">                                <a class="code" href="classutil_1_1Point.html">Point&lt;decimal&gt;</a>&amp; left, <a class="code" href="classutil_1_1Point.html">Point&lt;decimal&gt;</a>&amp; right );</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keyword">inline</span> decimal FindRealDistance (    <a class="code" href="classutil_1_1Point.html">Point&lt;decimal&gt;</a>&amp; opposite,</div><div class="line">                                                <a class="code" href="classutil_1_1Point.html">Point&lt;decimal&gt;</a>&amp; other )</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> opposite.<a name="a6"></a><a class="code" href="classutil_1_1Point.html#a8f90a6d1ce481f74c1d8790f4e30770a">Distance</a>(other) * fov / pixel_resolution;</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">bool</span> SortByOdds          ( StarSet&amp; larger, StarSet&amp; smaller );</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">template</span>&lt;const u<span class="keywordtype">int</span> NI, const u<span class="keywordtype">int</span> NO&gt;</div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> FindElements (</div><div class="line">                            <span class="keyword">const</span> decimal database[][6], uint <a name="a7"></a><a class="code" href="namespacestar__tracker.html#aec9619ecae222c6615d448fa87324566">database_size</a>,</div><div class="line">                            <a class="code" href="classutil_1_1ArrayList.html">ArrayList&lt;star_tracker::StarSet, NI&gt;</a>&amp; angles,</div><div class="line">                            decimal tA, decimal tD,</div><div class="line">                            <a class="code" href="classutil_1_1ArrayList.html">ArrayList&lt;star_tracker::StarSet, NO&gt;</a>* found</div><div class="line">                            )</div><div class="line">    {</div><div class="line">        <span class="keywordflow">for</span> ( uint ii = 0; ii &lt; angles.<a name="a8"></a><a class="code" href="classutil_1_1ArrayList.html#ae098e879892c23b682edc4b023a770de">Size</a>(); ii++)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">for</span> ( uint jj = 0; jj &lt; <a class="code" href="namespacestar__tracker.html#aec9619ecae222c6615d448fa87324566">database_size</a>; jj++ )</div><div class="line">            {</div><div class="line">                decimal dAngle = database[jj][kDatabaseIndexAngle];</div><div class="line">                decimal dDist = database[jj][kDatabaseIndexDist];</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (    fabs(dAngle - angles.<a name="a9"></a><a class="code" href="classutil_1_1ArrayList.html#ac5a4259af59f7bac9df06851c29d9e37">Get</a>(ii).<a name="a10"></a><a class="code" href="classstar__tracker_1_1StarSet.html#af834c889627c1d36810ed570f869bcf8">angle</a>) &lt; tA)<span class="comment">// &amp;&amp;</span></div><div class="line">                    <span class="comment">//  fabs(dDist - angles.Get(ii).distance) &lt; tD  )</span></div><div class="line">                {</div><div class="line">                    <a class="code" href="classutil_1_1Point.html">Point&lt;decimal&gt;</a> opposite(</div><div class="line">                                database[jj][kDatabaseIndexOppositeX],</div><div class="line">                                database[jj][kDatabaseIndexOppositeY]);</div><div class="line">                    <a name="_a11"></a><a class="code" href="classstar__tracker_1_1StarSet.html">star_tracker::StarSet</a> <span class="keyword">set</span>;</div><div class="line">                    <span class="keyword">set</span>.<a class="code" href="classstar__tracker_1_1StarSet.html#af834c889627c1d36810ed570f869bcf8">angle</a> = dAngle;</div><div class="line">                    <span class="keyword">set</span>.distance = dDist;</div><div class="line">                    <span class="keyword">set</span>.opposite = opposite;</div><div class="line">                    <span class="keyword">set</span>.orientation = database[jj][kDatabaseIndexOrientation];</div><div class="line"></div><div class="line">                    <span class="keyword">set</span>.pixel = &amp;angles.<a class="code" href="classutil_1_1ArrayList.html#ac5a4259af59f7bac9df06851c29d9e37">Get</a>(ii);</div><div class="line">                    found-&gt;<a name="a12"></a><a class="code" href="classutil_1_1ArrayList.html#a75e2f1682ebe7a982b6fd301d416d536">PushBack</a>(<span class="keyword">set</span>);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> set_fov              ( decimal f ) {     fov = f;    }</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> set_pixel_resolution ( decimal p ){pixel_resolution = p;}</div><div class="line">};</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
