<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Star Tracker: /mnt/c/Users/soyuz/Desktop/Star_Tracker_Microcontroller/libs/image_processing/blob.h</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Star Tracker
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">/mnt/c/Users/soyuz/Desktop/Star_Tracker_Microcontroller/libs/image_processing/blob.h</div>  </div>
</div><!--header-->
<div class="contents">
<p>This class is to provide details on a single blob. To do get this information, it must use the grassfire method. This method looks at the pixels adjacent to the start pixel and if they are within the bounds, it will add them to a queue. When it is added to the queue it will set the pixel to 0. Once it is done this, it will have the dimentions of the pixel.</p>
<p>To find the centroid of the pixel, it uses a weighted average of: (prevous_centroid * previous_intensity + add_point * add_intensity) / (previous_intensity + add_intensity).</p>
<p>In this process the image is destroyed as all blobs are set to 0.</p>
<pre class="fragment">const uint array_size = 100;
ArrayList&lt;Blob, array_size&gt; blobs;
Blob::FindBlobs&lt;array_size&gt;(img.PercentThreshold&lt;array_size&gt;(0.5, histogram), &amp;img, &amp;array_size);
blobs.Get(0).get_centroid_x(); // The center weighted pixel on the x axis.
blobs.Get(0).get_centroid_y(); // The center weighted pixel on the y axis.
</pre><dl class="section author"><dt>Author</dt><dd>Tom Creusot</dd></dl>
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> *  To search for and store details on a blob.</span></div><div class="line"><span class="comment"> *  @file   blob.h</span></div><div class="line"><span class="comment"> *  @author Tom Creusot</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> *  @reference</span></div><div class="line"><span class="comment"> *              Uses simmilar logic to:</span></div><div class="line"><span class="comment"> *              http://what-when-how.com/</span></div><div class="line"><span class="comment">                introduction-to-video-and-image-processing/</span></div><div class="line"><span class="comment">                blob-analysis-introduction-to-video-and-image-processing-part-1/</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#pragma once</span></div><div class="line"></div><div class="line"><span class="comment">// #include &lt;queue&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="util_8h.html">libs/util/util.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="point_8h.html">libs/util/point.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="array__list_8h.html">libs/util/array_list.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="image_8h.html">image.h</a>&quot;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceutil.html">util</a>;</div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacestd.html">std</a>;</div><div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceimage__processing.html">image_processing</a></div><div class="line">{</div><div class="line"></div><div class="line"><span class="keyword">class </span>Blob</div><div class="line">{</div><div class="line"><span class="comment">// protected:</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <a name="_a0"></a><a class="code" href="classutil_1_1Point.html">Point&lt;uint&gt;</a> origin;</div><div class="line">    uint width;</div><div class="line">    uint height;</div><div class="line">    uint pixels;</div><div class="line">    uint intensity;</div><div class="line">    <a name="_a1"></a><a class="code" href="classutil_1_1Point.html">Point&lt;decimal&gt;</a> centroid;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">template</span>&lt;const u<span class="keywordtype">int</span> N1, const u<span class="keywordtype">int</span> N2&gt;</div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> FindBlobs ( byte threshold, Image* img, <a name="_a2"></a><a class="code" href="classutil_1_1ArrayList.html">ArrayList&lt;Blob, N1&gt;</a>* list )</div><div class="line">    {</div><div class="line">        <span class="keywordflow">for</span> ( uint y = 0; y &lt; img-&gt;GetHeight(); y++ )</div><div class="line">        {</div><div class="line">            <span class="keywordflow">for</span> ( uint x = 0; x &lt; img-&gt;GetWidth(); x++ )</div><div class="line">            {</div><div class="line">                <span class="comment">// Is the pixel valid?</span></div><div class="line">                <span class="keywordflow">if</span> ( img-&gt;GetPixel(x, y) &gt; threshold )</div><div class="line">                {</div><div class="line">                    Blob blob(x, y);</div><div class="line">                    blob.SpreadGrassFire&lt;N2&gt; ( threshold, img );</div><div class="line">                    list-&gt;<a name="a3"></a><a class="code" href="classutil_1_1ArrayList.html#a75e2f1682ebe7a982b6fd301d416d536">PushBack</a>(blob);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    Blob                    ( );</div><div class="line"></div><div class="line"></div><div class="line">    Blob                    ( uint x, uint y );</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// /// @return The number of pixels in the blob.</span></div><div class="line">    <span class="comment">// uint     inline  get_pixels          ( ) const   { return pixels;        }</span></div><div class="line">    <span class="comment">// /// @return The intensity of all the pixels added together.</span></div><div class="line">    <span class="comment">// uint     inline  get_intensity       ( ) const   { return intensity;     }</span></div><div class="line">    <span class="comment">// /// @return The actual center of the blob x.</span></div><div class="line">    <span class="comment">// decimal  inline  get_centroid_x      ( ) const   { return centroid.x;    }</span></div><div class="line">    <span class="comment">// /// @return The actual center of the blob y.</span></div><div class="line">    <span class="comment">// decimal  inline  get_centroid_y      ( ) const   { return centroid.y;    }</span></div><div class="line">    <span class="comment">// /// @return The left of the blob.</span></div><div class="line">    <span class="comment">// decimal inline   get_origin_x        ( ) const   { return origin.x;      }</span></div><div class="line">    <span class="comment">// /// @return The top of the blob.</span></div><div class="line">    <span class="comment">// decimal inline   get_origin_y        ( ) const   { return origin.y;      }</span></div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="comment">// /// @return The bounding width of the blob.</span></div><div class="line">    <span class="comment">// uint inline  get_width           ( ) const   { return width;         }</span></div><div class="line">    <span class="comment">// /// @return The bounding height of the blob.</span></div><div class="line">    <span class="comment">// uint inline  get_height          ( ) const   { return height;        }</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">template</span>&lt;const u<span class="keywordtype">int</span> N&gt;</div><div class="line">    <span class="keywordtype">void</span> SpreadGrassFire ( uint threshold, Image* img )</div><div class="line">    {</div><div class="line">        <a class="code" href="classutil_1_1ArrayList.html">util::ArrayList&lt;util::Point&lt;util::uint&gt;</a>, N&gt; q;</div><div class="line"></div><div class="line">        uint minX = round(centroid.<a name="a4"></a><a class="code" href="classutil_1_1Point.html#aacd055853a71c08675e1210ee7d7777b">x</a>), minY = round(centroid.<a name="a5"></a><a class="code" href="classutil_1_1Point.html#abf5df9373ece02d9b87f367cf12dd319">y</a>);</div><div class="line">        uint maxX = minX, maxY = minY;</div><div class="line"></div><div class="line">        q.<a name="a6"></a><a class="code" href="classutil_1_1ArrayList.html#a75e2f1682ebe7a982b6fd301d416d536">PushBack</a>(<a class="code" href="classutil_1_1Point.html">Point&lt;uint&gt;</a>(minX, minY));</div><div class="line"></div><div class="line">        <span class="keywordflow">while</span> ( !q.<a name="a7"></a><a class="code" href="classutil_1_1ArrayList.html#a8e33bd4f9e6a67140696cf24b8cc66b1">IsEmpty</a>() )</div><div class="line">        {</div><div class="line">            <a name="_a8"></a><a class="code" href="classutil_1_1Point.html">util::Point&lt;util::uint&gt;</a> pt = q.<a name="a9"></a><a class="code" href="classutil_1_1ArrayList.html#ac03915c0d58b62bf78148737be86fafc">PopBack</a>();</div><div class="line">            <span class="keywordflow">if</span>(img-&gt;ValidPixel(pt.<a name="a10"></a><a class="code" href="classutil_1_1Point.html#aacd055853a71c08675e1210ee7d7777b">x</a>, pt.<a name="a11"></a><a class="code" href="classutil_1_1Point.html#abf5df9373ece02d9b87f367cf12dd319">y</a>)&amp;&amp;img-&gt;GetPixel(pt.<a class="code" href="classutil_1_1Point.html#aacd055853a71c08675e1210ee7d7777b">x</a>, pt.<a class="code" href="classutil_1_1Point.html#abf5df9373ece02d9b87f367cf12dd319">y</a>)&gt;threshold)</div><div class="line">            {   <span class="comment">// 4 directional</span></div><div class="line"></div><div class="line">                q.<a class="code" href="classutil_1_1ArrayList.html#a75e2f1682ebe7a982b6fd301d416d536">PushBack</a>(<a class="code" href="classutil_1_1Point.html">util::Point&lt;uint&gt;</a>(pt.<a class="code" href="classutil_1_1Point.html#aacd055853a71c08675e1210ee7d7777b">x</a> + 1, pt.<a class="code" href="classutil_1_1Point.html#abf5df9373ece02d9b87f367cf12dd319">y</a>));</div><div class="line">                q.<a class="code" href="classutil_1_1ArrayList.html#a75e2f1682ebe7a982b6fd301d416d536">PushBack</a>(<a class="code" href="classutil_1_1Point.html">util::Point&lt;uint&gt;</a>(pt.<a class="code" href="classutil_1_1Point.html#aacd055853a71c08675e1210ee7d7777b">x</a> - 1, pt.<a class="code" href="classutil_1_1Point.html#abf5df9373ece02d9b87f367cf12dd319">y</a>));</div><div class="line">                q.<a class="code" href="classutil_1_1ArrayList.html#a75e2f1682ebe7a982b6fd301d416d536">PushBack</a>(<a class="code" href="classutil_1_1Point.html">util::Point&lt;uint&gt;</a>(pt.<a class="code" href="classutil_1_1Point.html#aacd055853a71c08675e1210ee7d7777b">x</a>, pt.<a class="code" href="classutil_1_1Point.html#abf5df9373ece02d9b87f367cf12dd319">y</a> + 1));</div><div class="line">                q.<a class="code" href="classutil_1_1ArrayList.html#a75e2f1682ebe7a982b6fd301d416d536">PushBack</a>(<a class="code" href="classutil_1_1Point.html">util::Point&lt;uint&gt;</a>(pt.<a class="code" href="classutil_1_1Point.html#aacd055853a71c08675e1210ee7d7777b">x</a>, pt.<a class="code" href="classutil_1_1Point.html#abf5df9373ece02d9b87f367cf12dd319">y</a> - 1));</div><div class="line">                <span class="comment">// Diagonals</span></div><div class="line">                q.<a class="code" href="classutil_1_1ArrayList.html#a75e2f1682ebe7a982b6fd301d416d536">PushBack</a>(<a class="code" href="classutil_1_1Point.html">util::Point&lt;uint&gt;</a>(pt.<a class="code" href="classutil_1_1Point.html#aacd055853a71c08675e1210ee7d7777b">x</a> - 1, pt.<a class="code" href="classutil_1_1Point.html#abf5df9373ece02d9b87f367cf12dd319">y</a> - 1));</div><div class="line">                q.<a class="code" href="classutil_1_1ArrayList.html#a75e2f1682ebe7a982b6fd301d416d536">PushBack</a>(<a class="code" href="classutil_1_1Point.html">util::Point&lt;uint&gt;</a>(pt.<a class="code" href="classutil_1_1Point.html#aacd055853a71c08675e1210ee7d7777b">x</a> - 1, pt.<a class="code" href="classutil_1_1Point.html#abf5df9373ece02d9b87f367cf12dd319">y</a> + 1));</div><div class="line">                q.<a class="code" href="classutil_1_1ArrayList.html#a75e2f1682ebe7a982b6fd301d416d536">PushBack</a>(<a class="code" href="classutil_1_1Point.html">util::Point&lt;uint&gt;</a>(pt.<a class="code" href="classutil_1_1Point.html#aacd055853a71c08675e1210ee7d7777b">x</a> + 1, pt.<a class="code" href="classutil_1_1Point.html#abf5df9373ece02d9b87f367cf12dd319">y</a> - 1));</div><div class="line">                q.<a class="code" href="classutil_1_1ArrayList.html#a75e2f1682ebe7a982b6fd301d416d536">PushBack</a>(<a class="code" href="classutil_1_1Point.html">util::Point&lt;uint&gt;</a>(pt.<a class="code" href="classutil_1_1Point.html#aacd055853a71c08675e1210ee7d7777b">x</a> + 1, pt.<a class="code" href="classutil_1_1Point.html#abf5df9373ece02d9b87f367cf12dd319">y</a> + 1));</div><div class="line"></div><div class="line"></div><div class="line">                minX        = (pt.<a class="code" href="classutil_1_1Point.html#aacd055853a71c08675e1210ee7d7777b">x</a> &lt; minX ? pt.<a class="code" href="classutil_1_1Point.html#aacd055853a71c08675e1210ee7d7777b">x</a> : minX);</div><div class="line">                minY        = (pt.<a class="code" href="classutil_1_1Point.html#abf5df9373ece02d9b87f367cf12dd319">y</a> &lt; minY ? pt.<a class="code" href="classutil_1_1Point.html#abf5df9373ece02d9b87f367cf12dd319">y</a> : minY);</div><div class="line">                maxX        = (pt.<a class="code" href="classutil_1_1Point.html#aacd055853a71c08675e1210ee7d7777b">x</a> &gt; maxX ? pt.<a class="code" href="classutil_1_1Point.html#aacd055853a71c08675e1210ee7d7777b">x</a> : maxX);</div><div class="line">                maxY        = (pt.<a class="code" href="classutil_1_1Point.html#abf5df9373ece02d9b87f367cf12dd319">y</a> &gt; maxY ? pt.<a class="code" href="classutil_1_1Point.html#abf5df9373ece02d9b87f367cf12dd319">y</a> : maxY);</div><div class="line"></div><div class="line">                <span class="keyword">const</span> byte px = img-&gt;GetPixel(pt.<a class="code" href="classutil_1_1Point.html#aacd055853a71c08675e1210ee7d7777b">x</a>, pt.<a class="code" href="classutil_1_1Point.html#abf5df9373ece02d9b87f367cf12dd319">y</a>);</div><div class="line">                <span class="comment">// Setting new centroid.</span></div><div class="line">                centroid.<a class="code" href="classutil_1_1Point.html#aacd055853a71c08675e1210ee7d7777b">x</a> = FindCentroid(centroid.<a class="code" href="classutil_1_1Point.html#aacd055853a71c08675e1210ee7d7777b">x</a>, intensity, pt.<a class="code" href="classutil_1_1Point.html#aacd055853a71c08675e1210ee7d7777b">x</a>, px);</div><div class="line">                centroid.<a class="code" href="classutil_1_1Point.html#abf5df9373ece02d9b87f367cf12dd319">y</a> = FindCentroid(centroid.<a class="code" href="classutil_1_1Point.html#abf5df9373ece02d9b87f367cf12dd319">y</a>, intensity, pt.<a class="code" href="classutil_1_1Point.html#abf5df9373ece02d9b87f367cf12dd319">y</a>, px);</div><div class="line">                <span class="comment">// Setting intensity.</span></div><div class="line">                intensity += (uint) px;</div><div class="line">                <span class="comment">// Setting pixels</span></div><div class="line">                pixels++;</div><div class="line">                <span class="comment">// Stops reading same px</span></div><div class="line">                img-&gt;SetPixel(pt.<a class="code" href="classutil_1_1Point.html#aacd055853a71c08675e1210ee7d7777b">x</a>, pt.<a class="code" href="classutil_1_1Point.html#abf5df9373ece02d9b87f367cf12dd319">y</a>, 0);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> ( pixels == 0 )  width = height = 0;</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            width = maxX - minX + 1;</div><div class="line">            height = maxY - minY + 1;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    decimal FindCentroid ( decimal centroid, uint intense,</div><div class="line">                                             uint point, byte weight );</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">template</span>&lt;const <span class="keywordtype">int</span> N&gt;</div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> ToPointList (   <a class="code" href="classutil_1_1ArrayList.html">ArrayList&lt;Blob, N&gt;</a>&amp; blobs,</div><div class="line">                                        <a class="code" href="classutil_1_1ArrayList.html">ArrayList</a>&lt;<a class="code" href="classutil_1_1Point.html">Point&lt;decimal&gt;</a>, N&gt;* points )</div><div class="line">    {</div><div class="line">        <span class="keywordflow">for</span> ( uint i = 0; i &lt; blobs.<a name="a12"></a><a class="code" href="classutil_1_1ArrayList.html#ae098e879892c23b682edc4b023a770de">Size</a>(); i++ )</div><div class="line">        {</div><div class="line">            points-&gt;PushBack(blobs.<a name="a13"></a><a class="code" href="classutil_1_1ArrayList.html#ac5a4259af59f7bac9df06851c29d9e37">Get</a>(i).centroid);</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">bool</span> SortByIntensity ( Blob&amp; larger, Blob&amp; smaller );</div><div class="line"></div><div class="line">};</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
